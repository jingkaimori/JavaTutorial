[TOC]

# 4. 异常

## 为什么需要异常

讲完《类与对象》后，布置了三角形的编程作业题。需要编写一个方法来判断输入是否能构成三角形。如果输入不能构造三角形，如何告诉构造函数的调用者？有的同学返回了一个有问题的三角形，而有的同学返回了另一种对象。在Java语言里，遇到这种情况，最好的办法是抛出异常。

Java编译器可以帮我们检查出程序的语法错误。然而，Java编译器不能预测用户的输入，因此用户输入不当引起的错误，编译器检测不到，类似于三角形边长错误。

## 4.1 异常类

```mermaid
graph TB;
Throwable --- Exeception --- RunTimeExeception;
Throwable --- Error;
```

Java提供了所有异常的父类Throwable，只有Throwable的子孙类才是异常类。

Throw有3个重要的子孙类，Exception、Error和RuntimeException

* Error类表示错误，比如内存溢出
* Exception表示程序可能恢复的异常，其子类名均以Exception做后缀
* RuntimeException是运行时异常，是由于程序自身问题引起的，比如数组下标越界



## 4.2 异常处理机制

### 4.2.1 try-catch

常用的异常处理语句try-catch格式如下:

```java
try {
	可能出现异常的语句
}
catch(SomeException e) {	//捕捉到的异常对象 e
    处理异常
}
```

### 4.2.2 try-catch-finally

捕捉异常的完全格式如下：

```java
try {
    可能会出现异常的语句
}
catch(SomeException e) {
    处理异常
}
finally {
    异常发生，方法返回之前，总是要执行的代码
}
```

### 处理文件访问的异常

如果读写外部文件时，文件被其他程序删除，那么读写操作就会出现异常。

```java
try (
    定义输入输出流（可被自动关闭的对象）
){
    可能会出现异常的语句
}
catch(SomeIOException e) {
    处理异常
}
```

## 4.3 抛出异常

如果某方法不知道如何处理异常，或者不想自己亲自去处理异常，则可以将本方法产生的异常抛出（throws），由上一级调用者去检查处理。

在Java应用中如果main方法也不知道如何处理异常，也可以抛出，由JVM处理异常


### 4.3.1 throws

抛出异常之前，必须用`throws`定义该方法将会抛出的异常。throws一般写在方法名的后面

### 4.3.2 throw

除了系统自己抛出异常之外，还可以主动抛出异常。异常可以从任何位置抛出，抛出异常后不再执行后续操作，而返回函数的调用者。如果调用者不处理异常，那么异常还会向上传播，直到回到主函数或被捕获。

抛出异常与函数返回有相似之处，但不完全等同。

值得注意的是，throw抛出的是一个实例，所以需要通过new生成一个异常实例
```java
try(){
    语句
}catch(SomeException e){
    throw new AnotherException("错误原因")
}
```

抛出异常时，还可以引用另外一个异常。
```java
try(){
    语句
}catch(SomeException e){
    throw new AnotherException("错误原因",e)
}
```



### 4.3.3 异常处理的缺点

虽然异常处理让程序有更好的容错性，更加健壮，但是异常处理机制也有弊端

加入异常处理后，原本流程清晰的代码变得可读性差，可能影响程序的执行效率。





然后咱们再讲多态、反射、注解、泛型，（也就是下星期）就可以开始数据库的学习了。数据库的基本语句我会在一周讲完，之后由另外一位学长给你们讲解JDBC，也就是Java连接数据库

他讲JDBC的时候我同样尽快把JavaScript的东西全部说完，然后咱们就可以开始一些小小的练手项目了